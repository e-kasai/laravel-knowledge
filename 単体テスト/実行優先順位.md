

---

#### phpunit vs .env.testing

1. vendor/bin/phpunit を直接実行した場合 = `phpunit.xml` が必ず読み込まれる

その中で `<server name="APP_ENV" value="testing"/>` がある → `APP_ENV=testing` がセットされる
さらに `<server name="DB_CONNECTION"...>` とか書いてあれば、それも環境変数として優先される

---
2. Artisan経由で実行した場合

例：
```bash
php artisan test
php artisan migrate --env=testing
```
この場合は .env.testing が読まれる

`.env.testing` が存在すれば `.env` の代わりに使われる

---

#### なぜそうなる

- Laravel の php artisan test も、素の vendor/bin/phpunit も、裏で PHPUnitを通して起動する
そのとき Laravel が
`$app->detectEnvironment(function () { return 'testing'; });`

みたいに自動で 環境を「testing」に固定する



#### 優先度まとめ

- `phpunit.xml` → PHPUnit直実行（vendor/bin/phpunit）
- `.env.testing` → Artisan経由で --env=testing 指定 or php artisan test
- `.env` → それ以外（通常のアプリ実行）

#### 実際どうするか？

A:  `phpunit.xml` にDB設定を直書き　→　`.env.testing` は不要
- 実行コマンドは以下
```bash
// phpコンテナ内
vendor/bin/phpunit tests/Feature/HelloTest.php
```

B:  `.env.testing` にまとめる
→ phpunit.xml から`<server name="DB_CONNECTION"...>` とかDB系を削除してコマンドはartisan
```bash
// phpコンテナ内

// 特定のテストだけしたいとき
php artisan test --filter=HelloTest
// 全部のテストを実行したいとき
php artisan test
```
