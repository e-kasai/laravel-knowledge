
---

ロジック（処理）専用の箱
コントローラやモデルに詰め込みがちな処理を分けて入れておくクラス

#### メリット
- コントローラがスリム (100行超えたら黄色信号)
- 別のコントローラやジョブでも同じメソッドが使える
- 単体テストが簡単 外部リクエストをモックしやすい
- 複数モデルをまたいでの処理が可能
- 異なるユーザーの共通ロジックが１つで済む

---

3. コード例
`app/Services/PaymentService.php`

```php
<?php

namespace App\Services;

use Stripe\StripeClient;
use App\Models\Item;

class PaymentService
{
    public function __construct(private StripeClient $stripe) {}

    /**
     * チェックアウトURLを作成
     */
    public function createSession(Item $item, int $method, string $successUrl): string
    {
        $types = $method === 1 ? ['konbini'] : ['card'];

        $session = $this->stripe->checkout->sessions->create([
            'mode'                 => 'payment',
            'payment_method_types' => $types,
            // ... line_items など省略 ...
            'success_url'          => $successUrl,
            'cancel_url'           => route('details.show', $item, true),
        ]);

        return $session->url;
    }
}
```

#### どう呼び出す？

```php
// PurchaseController の一部
public function __construct(private \App\Services\PaymentService $pay) {}

public function purchaseItem(...)
{
    // 省略…
    $url = $this->pay->createSession($item, 2, route('purchase.complete', [], true));
    return redirect($url);
}
```

Laravel は型ヒント（PaymentService）だけで自動 DI してくれる


