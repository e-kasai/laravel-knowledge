---
tags: 中間テーブル
---


### ① 純粋なピボットテーブル　＝　中間テーブルと呼ぶ

役割：ただ「AとBの関連」をつなぐだけ、自分の実体はない。
カラム構成：外部キー 2つ（＋timestamps を付けることもある）。
モデルクラス：不要。belongsToMany で直接扱う。

例：中間テーブル（favoritesテーブルのmigrationファイル）
```php
Schema::create('favorites', function (Blueprint $table) {
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->foreignId('item_id')->constrained()->cascadeOnDelete();
    $table->timestamps();
    $table->unique(['user_id', 'item_id']); // 重複禁止
});
```

Userモデル
```php
public function favoriteItems()
    {
        return $this->belongsToMany(Item::class, 'favorites', 'user_id', 'item_id'); //belongsToManyで中間テーブルを直接扱う
    }
```
Itemモデル
```php
public function favoritedByUsers()
    {
        return $this->belongsToMany(User::class, 'favorites', 'item_id', 'user_id'); //belongsToManyで中間テーブルを直接扱う
    }
```


特徴
User モデル → favoriteItems()
Item モデル → favoritedByUsers()
$user->favoriteItems のようにそのまま使える。

---
### ② 中間テーブルが独自のカラムを持つ場合　＝　関連テーブルと呼ぶ

役割：「関係」＋「付随する情報」を管理。
カラム構成：外部キー + 追加カラム（例：body, role, price など）。
モデルクラス：必要

例：レビュー（reviews）
```php
Schema::create('reviews', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->foreignId('item_id')->constrained()->cascadeOnDelete();
    $table->tinyInteger('rating');
    $table->text('body');
    $table->timestamps();
});
```


特徴

もはや「ただのピボット」ではなく独立したエンティティ。
モデルを作成して $user->reviews や $item->reviews として使う。
この場合 belongsToMany ではなく、hasMany（リレーションモデル側） / belongsTo（関連テーブル側） の組み合わせを使う。