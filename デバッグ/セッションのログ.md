
---

### ログでセッションを確認する

0. 準備

ログファイルの場所：storage/logs/laravel.log

ターミナルでリアルタイム表示するなら
tail -f storage/logs/laravel.log

1. どこに \Log::debug() を置く？
コンビニ購入フローを例にします。

if ($paymentMethod === self::METHOD_KONBINI) {

    // ① 下ごしらえ（before）
    \Log::debug('draft before', session()->all());

    $profile         = $user->profile;
    $shippingAddress = $this->buildShippingAddress($item, $profile);
    $this->completePurchase($item, $user->id, $shippingAddress, self::METHOD_KONBINI);

    // セッション掃除
    session()->forget("draft_address.{$item->id}");

    // ② 後片づけ（after）
    \Log::debug('draft after', session()->all());
}


ポイント

before：session()->forget() の 前 に
draft_address.xxx が 存在 していることを確認

after：session()->forget() の 後 に
そのキーが 消えている ことを確認

2. ログの見え方（例）
[2025-09-21 15:04:01] local.DEBUG: draft before {"draft_address":{"42":{"postal_code":"123-4567","address":"東京都"}}}
[2025-09-21 15:04:01] local.DEBUG: draft after []


draft before に 住所ドラフト配列がある
draft after では 空配列 → キレイに消えた！