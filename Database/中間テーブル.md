
---

# ピボットテーブル（中間テーブル）のルールまとめ

## テーブル名のルール

デフォルト規約：item_user のように アルファベット順で単数形を _ で連結
独自名にする場合：

例）favoritesにしたい
belongsToMany(..., 'favorites', ...) などモデル側でテーブル名を明示すればOK

---

## カラム名のルール

外部キーは <モデル名>_id とする
例）user_id , item_id

belongsToMany 定義と順番を合わせることが重要
// Item モデル側
return $this->belongsToMany(User::class, 'favorites', 'item_id', 'user_id');

理由：
Eloquent がリレーションを張るときに、
「この Item の id を item_id に突っ込んで、中間テーブルと結合する」
「さらに user_id で User テーブルにつなぐ」
という処理を 内部で自動生成します。

もし順番を逆にすると…

「Item.id を user_id に当てはめて JOIN する」ことになり、
意図した結合ができず データが取れなくなる

---

## 主キー・ユニーク制約

1ユーザーが同じ商品に複数いいねできないようにするなどユニーク制約が必要な時：
$table->unique(['user_id', 'item_id']);

代替案：複合主キーにしても良い
$table->primary(['user_id', 'item_id']);

---

## 外部キー制約

外部キーをつけて参照整合性を担保する

$table->foreignId('user_id')->constrained()->cascadeOnDelete();
$table->foreignId('item_id')->constrained()->cascadeOnDelete();

---

## idカラムについて

ピボットテーブルは 通常 id カラム不要
もし id を作るなら、必ず unique(['user_id', 'item_id']) を設定して重複防止すること

---

## まとめ

テーブル名はデフォルト規約 or 独自名（modelで明示すれば自由）
外部キーは user_id, item_id が基本
重複禁止は unique or 複合主キー
外部キー制約をつけると堅牢
id はなくてもOK（あれば unique 必須）